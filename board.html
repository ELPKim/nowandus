<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Board - Now and Us</title>
    <link rel="icon" type="image/png" href="favicon1.png">
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@800;900&family=Noto+Sans+KR:wght@300;500;700&display=swap" rel="stylesheet">
    
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getDatabase, ref, push, onValue, update, remove } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "__FIREBASE_API_KEY__", 
            authDomain: "nowandus-84652.firebaseapp.com",
            projectId: "nowandus-84652",
            databaseURL: "https://nowandus-84652-default-rtdb.firebaseio.com", 
            storageBucket: "nowandus-84652.appspot.com",
            messagingSenderId: "1062456335332",
            appId: "1:1062456335332:web:..."
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        window.db = db;
        window.dbRef = ref;
        window.dbPush = push;
        window.dbOnValue = onValue;
        window.dbUpdate = update;
        window.dbRemove = remove;
    </script>

    <style>
        .board-container { max-width: 800px; margin: 30px auto; padding: 20px; }
        .write-section { background: white; padding: 25px; border-radius: 20px; margin-bottom: 30px; box-shadow: 0 10px 20px rgba(0,0,0,0.05); }
        .post-card { background: white; padding: 20px; border-radius: 15px; margin-bottom: 15px; text-align: left; border: 1px solid #eee; transition: all 0.3s; }
        .post-card:hover { border-color: var(--primary-color); }
        .post-header { display: flex; justify-content: space-between; font-size: 0.8rem; color: #999; margin-bottom: 10px; }
        .post-title { font-weight: bold; font-size: 1.1rem; color: var(--accent-color); cursor: pointer; display: flex; align-items: center; justify-content: space-between; }
        .post-content { display: none; margin-top: 15px; padding-top: 15px; border-top: 1px dashed #eee; font-size: 0.95rem; line-height: 1.6; }
        .admin-reply { margin-top: 15px; padding: 15px; background: #fff0f3; border-radius: 10px; color: var(--accent-color); border-left: 4px solid var(--primary-color); }
        .admin-panel { margin-top: 20px; padding: 15px; background: #f9f9f9; border-radius: 10px; border: 1px solid #ddd; }
        .secret-badge { font-size: 0.7rem; background: #f1f1f1; padding: 2px 8px; border-radius: 10px; color: #888; }
        .input-row { display: flex; gap: 10px; margin-bottom: 10px; }
        .input-row input { flex: 1; }
    </style>
</head>
<body>
    <div class="background-decor">
        <div class="circle circle-1"></div>
        <div class="circle circle-2"></div>
    </div>

    <header>
        <div class="language-switcher">
            <button onclick="setLanguage('ko')">KR</button>
            <button onclick="setLanguage('en')">EN</button>
        </div>
        <h1 data-i18n="board-header">ê²Œì‹œíŒ (Board)</h1>
        <p data-i18n="board-subtitle">ìš°ë¦¬ì˜ ì†Œì¤‘í•œ ì´ì•¼ê¸°ì™€ ì˜ê²¬ì„ ë‚¨ê²¨ì£¼ì„¸ìš”</p>
    </header>

    <main class="board-container">
        <div class="write-section">
            <h3 data-i18n="board-write-title" style="margin-top:0; color:var(--primary-color);">ìƒˆ ê¸€ ë‚¨ê¸°ê¸°</h3>
            <div class="input-row">
                <input type="text" id="post-nick" class="input-field" placeholder="ë‹‰ë„¤ì„ (Nickname)">
                <input type="password" id="post-pw" class="input-field" placeholder="ë¹„ë°€ë²ˆí˜¸ (Password)">
            </div>
            <input type="text" id="post-title" class="input-field" placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš” (Title)">
            <textarea id="post-msg" class="input-field" style="height: 100px;" placeholder="ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”. ê´€ë¦¬ìì™€ ë³¸ì¸ë§Œ ë³¼ ìˆ˜ ìˆëŠ” ë¹„ë°€ê¸€ë¡œ ë³´í˜¸ë©ë‹ˆë‹¤."></textarea>
            <button onclick="submitPost()" class="btn-action" data-i18n="ps-btn">ë“±ë¡í•˜ê¸°</button>
        </div>

        <h3 data-i18n="board-my-list" style="text-align:left; color:var(--accent-color); margin-left:10px;">ê²Œì‹œê¸€ ëª©ë¡</h3>
        <div id="posts-list">
            <p style="text-align:center; color:#999; padding:40px;">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
        </div>

        <div style="margin-top: 50px; text-align:center;">
            <button onclick="toggleAdminPanel()" style="background:none; border:none; color:#eee; cursor:pointer; font-size:0.7rem;">Admin Access</button>
            <div id="admin-login-ui" style="display:none; margin-top:10px;">
                <input type="password" id="admin-master-pw" class="input-field" style="width:200px;" placeholder="Master Password" onchange="verifyAdmin()">
            </div>
        </div>

        <a href="index.html" class="back-link" data-i18n="ps-back" style="display:block; margin-top:30px; text-align:center;">â† ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
    </main>

    <script src="main.js"></script>
    <script>
        let isSystemAdmin = false;

        function submitPost() {
            const nick = document.getElementById('post-nick').value;
            const pw = document.getElementById('post-pw').value;
            const title = document.getElementById('post-title').value;
            const msg = document.getElementById('post-msg').value;

            if(!nick || !pw || !title || !msg) return alert(currentLanguage === 'ko' ? "ëª¨ë“  í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”." : "Please fill in all fields.");

            if(window.dbPush) {
                window.dbPush(window.dbRef(window.db, 'posts'), {
                    nick, pw, title, msg, timestamp: Date.now(), reply: ""
                }).then(() => {
                    alert(currentLanguage === 'ko' ? "ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤." : "Successfully posted.");
                    document.getElementById('post-title').value = "";
                    document.getElementById('post-msg').value = "";
                });
            } else {
                alert("Firebase Error: Check configuration.");
            }
        }

        function loadPosts() {
            if(!window.dbOnValue) return;
            window.dbOnValue(window.dbRef(window.db, 'posts'), (snapshot) => {
                const data = snapshot.val();
                const list = document.getElementById('posts-list');
                if(!data) { 
                    list.innerHTML = `<p style='text-align:center; color:#999; padding:40px;'>${currentLanguage === 'ko' ? 'ì•„ì§ ì‘ì„±ëœ ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.' : 'No posts yet.'}</p>`; 
                    return; 
                }

                const items = Object.entries(data).reverse();
                list.innerHTML = items.map(([id, p]) => `
                    <div class="post-card">
                        <div class="post-header"><span>ğŸ‘¤ ${p.nick}</span><span>${new Date(p.timestamp).toLocaleDateString()}</span></div>
                        <div class="post-title" onclick="unlockPost('${id}', '${p.pw}')">
                            <span>${p.title}</span>
                            <span class="secret-badge">ğŸ”’ ${currentLanguage === 'ko' ? 'ë¹„ë°€ê¸€' : 'Secret'}</span>
                        </div>
                        <div class="post-content" id="msg-${id}">
                            <div style="white-space:pre-wrap; margin-bottom:15px;">${p.msg}</div>
                            ${p.reply ? `<div class="admin-reply"><strong>${currentLanguage === 'ko' ? 'ë‹µë³€' : 'Reply'}:</strong> ${p.reply}</div>` : ''}
                            ${isSystemAdmin ? `
                                <div class="admin-panel">
                                    <textarea id="reply-text-${id}" class="input-field" placeholder="ë‹µë³€ ë‚´ìš©">${p.reply || ''}</textarea>
                                    <button onclick="saveReply('${id}')" class="settings-btn">ë‹µë³€ ì €ì¥</button>
                                    <button onclick="deletePost('${id}')" style="color:red; background:none; border:none; margin-left:10px; cursor:pointer; font-size:0.8rem;">ì‚­ì œ</button>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `).join('');
            });
        }

        function unlockPost(id, correctPw) {
            if(isSystemAdmin) { 
                const el = document.getElementById(`msg-${id}`);
                el.style.display = el.style.display === 'block' ? 'none' : 'block';
                return; 
            }
            const pw = prompt(currentLanguage === 'ko' ? "ì‘ì„± ì‹œ ì„¤ì •í•œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:" : "Enter the password you set:");
            if(pw === correctPw) {
                document.getElementById(`msg-${id}`).style.display = 'block';
            } else if(pw !== null) {
                alert(currentLanguage === 'ko' ? "ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤." : "Incorrect password.");
            }
        }

        function toggleAdminPanel() {
            const ui = document.getElementById('admin-login-ui');
            ui.style.display = ui.style.display === 'none' ? 'block' : 'none';
        }

        function verifyAdmin() {
            // ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸: admin1234 (í•„ìš”ì‹œ ë³€ê²½í•˜ì„¸ìš”)
            if(document.getElementById('admin-master-pw').value === "admin1234") {
                isSystemAdmin = true; 
                alert("ê´€ë¦¬ì ëª¨ë“œê°€ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤."); 
                loadPosts();
            }
        }

        function saveReply(id) {
            const txt = document.getElementById(`reply-text-${id}`).value;
            window.dbUpdate(window.dbRef(window.db, `posts/${id}`), { reply: txt })
                .then(() => alert(currentLanguage === 'ko' ? "ë‹µë³€ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤." : "Reply saved."));
        }

        function deletePost(id) {
            if(confirm(currentLanguage === 'ko' ? "ì •ë§ ì´ ê¸€ì„ ì‚­ì œí• ê¹Œìš”?" : "Delete this post?")) {
                window.dbRemove(window.dbRef(window.db, `posts/${id}`));
            }
        }

        window.addEventListener('load', () => {
            setTimeout(loadPosts, 1000);
        });
    </script>
</body>
</html>